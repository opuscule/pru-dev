<div>
    <style>
        @media (min-width: 1440px) {
            #homepage-hero {
                padding-top: 10vw !important;
            }
            #homepage-hero .next_section_tab {
                margin-top: 11vw !important;
            }
        }
        @media (min-width: 1919px) {
            #homepage-hero {
                background-position: center -4vw !important;
            }
            #homepage-hero .next_section_tab {
                margin-top: 13vw !important;
            }
        }
        #homepage-hero .bg-cover.bg-center {
            z-index: 1;
            position: relative;
        }
        .choices__list.choices__list--single {
            margin-left: 15px;
        }
        #homepage-hero:before {
            background: linear-gradient(90deg, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0) 50%);
            content: '';
            height: 100%;
            left: 0;
            position: absolute;
            top: 0;
            width: 100%;
            z-index: -1;
        }

        .container-width-banner {
            max-width: var(--width-container-content);
            margin-inline: auto;
            padding-bottom: 3rem !important;
            padding-left: 2rem;
            padding-right: 2rem;
        }

        #homepage-hero > div::before {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            /* background: linear-gradient(90deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 50%); */
            z-index: 0;
        }
        .text-home-index {
            font-size: clamp(2.75rem, 1.625rem + 3.75vw, 5rem);
            line-height: 1;
        }
        .messed-up-top {
            margin-top: -62px;
            z-index: 999;
            position: relative;
        }
        /* Limit dropdown height and enable scrolling */
        #breed-search .choices__list--dropdown {
            max-height: 250px; /* adjust height as you prefer */
            width: 90%;
            overflow-y: auto; /* enable vertical scroll */
            overflow-x: hidden; /* prevent horizontal scroll */
            scrollbar-width: thin; /* Firefox thin scrollbar */
            scrollbar-color: #ccc transparent; /* scrollbar styling for Firefox */
            right: 0px;
        }

        /* Optional: prettier scrollbar for WebKit browsers */
        #breed-search .choices__list--dropdown::-webkit-scrollbar {
            width: 6px;
        }
        .next_section_tab {
            margin: 0 auto;
            position: inherit;
            margin-top: 3rem;
        }
        .ns_label {
            background-color: var(--color-primary);
            border-radius: 0.25em 0.25em 0 0;
            color: #fff;
            display: table;
            font-size: 3rem;
            font-weight: 600;
            line-height: 1;
            margin: auto;
            padding: 0.2em 1em 0;
            text-align: center;
        }

        #breed-search .choices__list--dropdown::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 4px;
        }

        #breed-search .choices__list--dropdown::-webkit-scrollbar-thumb:hover {
            background-color: #aaa;
        }
    </style>

    <section
        id="homepage-hero"
        class="relative isolate pt-40 bg-cover bg-[url('https://cdn.shopify.com/s/files/1/0603/0471/9957/files/puppysrus-banner-2023.webp?v=1764048706')] bg-[position:center_-3rem]"
    >
        <div class="bg-cover bg-center">
            <div class="container-width-banner">
                <div class="max-w-xl banner_content z-10 relative">
                    <h1 class="text-home-index text-white">We have the perfect addition to your family.</h1>
                    <p role="heading" class="text-white text-lg">Creating happier homes one puppy at a time.</p>
                    <div id="breed-search" class="mt-6 flex items-stretch rounded-full bg-white shadow max-w-xl">
                        <select
                            class="choices-single flex-1"
                            id="collection-select"
                            aria-label="Find your breed"
                            style="border-bottom: 0px;"
                        >
                            <option value="">Find Your Breed</option>
                            {% for collection in collections %}
                                {% if collection.metafields.custom.shown_on_website == true %}
                                    <option value="{{ collection.url }}">{{ collection.title }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        <button
                            id="breed-search-btn"
                            type="button"
                            style="border-top-right-radius: 33px;border-bottom-right-radius: 33px;"
                            class="px-6 bg-primary text-white font-bold text-sm tracking-wide uppercase disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus-visible:ring-4 focus-visible:ring-primary/60 focus-visible:ring-offset-2 focus-visible:ring-offset-white transition"
                            disabled
                        >
                            Search
                        </button>
                    </div>
                </div>
            </div>
            <div class="next_section_tab mt-5 flex justify-center">
                <h2 class="bg-primary rounded-t text-white inline-flex text-5xl font-semibold leading-none mx-auto pt-[0.2em] px-[1em] text-center">Browse by Breed</h2>
            </div>
        </div>
    </section>
</div>

<!--
    <div class="text-center messed-up-top">
      <h2 class="inline-block bg-primary text-white font-titles text-center mx-auto mb-0 pt-0.5 px-4 text-5xl leading-tight" style="border-top-left-radius:.25em;border-top-right-radius:.25em;">Our Newest Additions</h2>
    </div>
-->

<section id="available-breeds" class="border-t-8 border-t-primary py-12">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
    <div class="max-w-[var(--width-container-content)] mx-auto px-8">

        <!-- carousel of breeds available -->
        <div
            id="homepage-breeds-carousel"
            class="splide relative"
            role="group"
            aria-label="Available breeds carousel"
        >
            <div class="splide__track">
                <ul class="splide__list">
                    {% for collection in collections %}
                        {% if collection.products_count > 0 and collection.handle != 'all' and collection.handle != 'frontpage' %}
                            {% assign breed_image = collection.image %}
                            {% if breed_image == blank %}
                                {% assign breed_image = collection.products.first.featured_image %}
                            {% endif %}
                            
                            <li class="splide__slide">
                                <a href="{{ collection.url }}" class="block group h-full">
                                    <div class="flex flex-col rounded-3xl overflow-hidden shadow-sm hover:shadow-md transition-all pb-4 bg-bg-card align-top">
                                        <div class="relative w-full aspect-square overflow-hidden">
                                            {% if breed_image != blank %} 
                                                <img 
                                                    src="{{ breed_image | image_url: width: 400, height: 400, crop: 'center' }}"
                                                    alt="{{ collection.title | escape }}"
                                                    loading="lazy"
                                                    width="400"
                                                    height="400"
                                                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                                >
                                            {% else %}
                                                <img 
                                                    src="https://picsum.photos/350" 
                                                    alt="{{ collection.title | escape }}" 
                                                    loading="lazy"
                                                    width="350"
                                                    height="350"
                                                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                                                >
                                            {% endif %}
                                        </div>
                                        <div class="p-4 pb-1 text-center border-t-4 border-t-primary">
                                            <h3 class="font-titles font-bold text-3xl group-hover:text-primary transition-colors leading-tight tracking-tight">{{ collection.title }}s</h3>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>

            <!-- Custom navigation arrows -->
            <button
                id="breeds-prev"
                type="button"
                aria-label="Previous breeds"
                class="
                    puppies-arrow absolute top-1/2 -translate-y-1/2 left-4
                    bg-[rgba(238,106,91,0.6)] hover:bg-[rgba(238,106,91,0.85)]
                    w-12 h-12 rounded-full z-10 flex items-center justify-center
                    text-white text-[45px] leading-[0] p-0 cursor-pointer select-none
                    focus:outline-none focus-visible:ring-4 focus-visible:ring-primary/60
                    focus-visible:ring-offset-2 focus-visible:ring-offset-white transition
                    pb-1 pr-[2pxgit]
                "
            >
                <span class="block translate-y-[2px]" style="margin-top: -10px;">&lsaquo;</span>
            </button>

            <button
                id="breeds-next"
                type="button"
                aria-label="Next breeds"
                class="
                    puppies-arrow absolute top-1/2 -translate-y-1/2 right-4
                    bg-[rgba(238,106,91,0.6)] hover:bg-[rgba(238,106,91,0.85)]
                    w-12 h-12 rounded-full z-10 flex items-center justify-center
                    text-white text-[45px] leading-[0] p-0 cursor-pointer select-none
                    focus:outline-none focus-visible:ring-4 focus-visible:ring-primary/60
                    focus-visible:ring-offset-2 focus-visible:ring-offset-white transition
                "
            >
                <span class="block translate-y-[2px]" style="margin-top: -10px;">&rsaquo;</span>
            </button>
        </div>
        <script defer src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>

        <div class="my-12 text-center">
            <a
                href="{{ routes.all_products_collection_url }}"
                class="btn btn-primary transition-colors duration-300 hover:bg-white hover:text-primary focus:bg-white focus:text-primary outline-none"
            >
                {{ 'general.view_all_puppies' | t | default: 'View All Puppies' }}
            </a>
        </div>
    </div>
</section>






{% render 'puppiesrus-difference' %}

{% render 'meet-a-breeder' %}

<section id="about_us">
    <div class="max-w-[var(--width-container-content)] mx-auto px-4 mb-16">
        <div class="flex items-center flex-wrap justify-between">
            <div class="pr-0 md:pr-5 w-full md:w-2/5 mb-4 md:mb-0">
                <h2 class="font-titles text-6xl font-semibold leading-tight">About Us</h2>
                <h3 class="font-titles text-4xl leading-tight mb-4">Sonny &amp; Amy Smith - Owners</h3>
                <p class="mb-4">We are passionate about finding and connecting families with their perfect puppy through responsible breeding. We've spent time building relationships with our breeder families to ensure we are providing families with healthy &amp; happy puppies!</p>
                <p class="mb-4">All puppies are raised around families, are well cared for and socialized before being placed with their furever homes. Above all, we understand adding a puppy to your family can be an overwhelming experience, for that reason, we take the time to understand your lifestyle and needs that way you end up with your perfect puppy!</p>
                <p>
                    <a class="btn btn-secondary inline-flex" href="/pages/about-us/">Learn more</a>
                </p>
            </div>
            <div class="w-full md:w-2/5">
                <img class="w-full border-b-8 border-l-8 border-solid border-[var(--color-primary)] rounded-l-3xl" src="https://cdn.shopify.com/s/files/1/0603/0471/9957/files/amy-sonny-puppysrus.webp?v=1764041698" alt="Owners Amy and Sonny" width="725" height="947" title="Owners Amy and Sonny Smith" decoding="async" loading="lazy">
            </div>
        </div>
    </div>
</section>

<!-- Embedded Testimonials (previously separate section) -->
<section id="happy-families" class="pt-24 pb-[200px] mb-[-200px] bg-[var(--color-bg-extralight)]">
    <div class="max-w-[var(--width-container-content)] mx-auto px-4">
        <h2 class="font-titles text-center text-5xl mb-16">Happy Families</h2>
        <div id="happy-families-slider" class="relative max-w-5xl mx-auto">
            <div id="happy-families-track" class="overflow-hidden">
                <div class="slides transition-all duration-500"></div>
            </div>
            <div class="dots flex items-center justify-center gap-4 mt-10" id="happy-families-dots"></div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        (async () => {
            const SPACE_ID = '{{ settings.contentful_space_id | escape }}';
            const ACCESS_TOKEN = '{{ settings.contentful_access_token | escape }}';
            const CONTENT_TYPE = 'happy_families';

            if (!SPACE_ID || !ACCESS_TOKEN) return;

            const endpoint = `https://cdn.contentful.com/spaces/${SPACE_ID}/environments/master/entries?access_token=${ACCESS_TOKEN}&content_type=${CONTENT_TYPE}&include=2`;
            try {
                const res = await fetch(endpoint);
                if (!res.ok) throw new Error(await res.text());
                const data = await res.json();
                const track = document.querySelector('#happy-families-track .slides');
                const dotsWrap = document.getElementById('happy-families-dots');
                if (!data.items || data.items.length === 0) {
                    track.innerHTML = '<p class="text-center">No testimonials found.</p>';
                    return;
                }
                const assetMap = new Map();
                if (data.includes && data.includes.Asset) {
                    for (const a of data.includes.Asset) assetMap.set(a.sys.id, a.fields);
                }
                const shuffled = data.items
                    .map((v) => ({ v, r: Math.random() }))
                    .sort((a, b) => a.r - b.r)
                    .map(({ v }) => v)
                    .slice(0, 8);

                const slides = [];
                shuffled.forEach((item, i) => {
                    const f = item.fields;
                    let imageUrl = '';
                    if (f.image && f.image.sys && f.image.sys.id) {
                        const asset = assetMap.get(f.image.sys.id);
                        if (asset && asset.file && asset.file.url) {
                            imageUrl = asset.file.url.startsWith('//') ? 'https:' + asset.file.url : asset.file.url;
                        }
                    }
                    const stars = '<span class="text-[#F2635B]">â˜…</span>'.repeat(5);
                    slides.push(`
              <div class="slide flex flex-col md:flex-row gap-8 items-start w-full shrink-0" data-index="${i}">
                <div class="relative shrink-0 mx-auto md:mx-0">
                  <div class="absolute -left-3 -bottom-3 w-[180px] h-[180px] rounded-[32px] bg-[#F2635B]"></div>
                  ${imageUrl ? `<img src="${imageUrl}?w=400&h=400" alt="${f.puppysName || ''}" width="400" height="400" class="relative rounded-[32px] w-[180px] h-[180px] object-cover" loading="lazy">` : '<div class="relative rounded-[32px] w-[180px] h-[180px] bg-gray-200"></div>'}
                </div>
                <div class="flex-1 max-w-2xl mx-auto md:mx-0">
                  <div class="mb-3 leading-none">${stars}</div>
                  <h3 class="font-titles text-5xl tracking-wide mb-5">${f.title || ''}</h3>
                  <p class="leading-relaxed">${f.quote || ''}</p>
                </div>
              </div>`);
                });

                track.style.display = 'flex';
                track.style.width = '100%';
                track.innerHTML = slides.join('');

                // Slider state
                let current = 0;
                function render() {
                    const all = track.querySelectorAll('.slide');
                    all.forEach((s, i) => {
                        s.style.display = i === current ? 'flex' : 'none';
                    });
                    dotsWrap.querySelectorAll('button').forEach((b, i) => {
                        b.classList.toggle('opacity-100', i === current);
                        b.classList.toggle('opacity-30', i !== current);
                    });
                }
                // Dots
                dotsWrap.innerHTML = slides.map((_, i) => `<button aria-label="Show testimonial ${i + 1}" class="w-5 h-5 rounded-full bg-neutral-700 opacity-30 transition" data-to="${i}"></button>`).join('');
                dotsWrap.addEventListener('click', (e) => {
                    const btn = e.target.closest('button[data-to]');
                    if (!btn) return;
                    current = parseInt(btn.dataset.to, 10);
                    render();
                });
                render();
            } catch (e) {
                console.error('Testimonials load error', e);
            }
        })();
    });
</script>

{% javascript %}
    document.addEventListener('DOMContentLoaded', function () {
        var selectElement = document.querySelector('.choices-single');

        if (selectElement) {
            var choices = new Choices(selectElement, {
                searchEnabled: true,
                itemSelectText: '',
                placeholder: true,
                placeholderValue: 'Find Your Breed',
                shouldSort: false,
            });

            var searchBtn = document.getElementById('breed-search-btn');

            function updateButtonState() {
                if (!searchBtn) return;
                if (selectElement.value) {
                    searchBtn.disabled = false;
                } else {
                    searchBtn.disabled = true;
                }
            }

            selectElement.addEventListener('change', updateButtonState);
            updateButtonState();

            if (searchBtn) {
                searchBtn.addEventListener('click', function () {
                    if (selectElement.value) {
                        window.location.href = selectElement.value;
                    }
                });
            }

            // Allow Enter key inside the choices input to trigger search
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Enter') {
                    var active = document.activeElement;
                    if (active && active.closest('#breed-search')) {
                        if (selectElement.value) {
                            e.preventDefault();
                            window.location.href = selectElement.value;
                        }
                    }
                }
            });
        }

        function initBreedsCarousel() {
            const el = document.getElementById('homepage-breeds-carousel');
            if (!el) return;
            
            const splide = new Splide('#homepage-breeds-carousel', {
                type: 'slide',
                perPage: 4,
                perMove: 1,
                gap: '0', 
                arrows: false,
                pagination: false,
                padding: { left: 0, right: 0 },
                focus: 'start',
                trimSpace: true,
                breakpoints: {
                    1023: { perPage: 3 },
                    767: { perPage: 2 },
                },
            }).mount();

            const prevBtn = document.getElementById('breeds-prev');
            const nextBtn = document.getElementById('breeds-next');
            if (prevBtn) prevBtn.addEventListener('click', () => splide.go('<'));
            if (nextBtn) nextBtn.addEventListener('click', () => splide.go('>'));
        }

        if (window.Splide) {
            initBreedsCarousel();
        } else {
            window.addEventListener('load', function () {
                if (window.Splide) initBreedsCarousel();
            });
        }
    });
{% endjavascript %}

{% stylesheet %}
    /* Add any custom styling for Choices.js here */
    .choices {
        width: 100%;
    }
    /* Breed search composite control */
    #breed-search {
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.06);
    }
    #breed-search:focus-within {
        box-shadow: 0 0 0 2px var(--color-primary, #ee6a5b);
    }
    #breed-search .choices {
        margin-bottom: 0;
    }
    #breed-search .choices__inner {
        display: flex;
        align-items: center;
        min-height: 0;
        border: none;
        background: transparent;
        padding: 0.75rem 1.25rem;
        font-size: 0.95rem;
        box-shadow: none;
        border-radius: 0; /* handled by wrapper */
    }
    #breed-search .choices__list {
        width: 100%;
    }
    #breed-search .choices__list--single {
        padding: 0;
    }
    #breed-search .choices__placeholder {
        opacity: 0.55;
    }
    #breed-search .choices__list--dropdown {
        border: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }
    #breed-search .choices__list--dropdown .choices__item--selectable.is-highlighted {
        background: var(--color-primary, #ee6a5b);
        color: #fff;
    }
    #breed-search-btn {
        letter-spacing: 0.5px;
    }


    /* Breeds Carousel Styles */
    #homepage-breeds-carousel .splide__track {
        overflow: hidden;
    }
    #homepage-breeds-carousel .splide__list {
        display: flex;
        gap: 2rem;
    }
    /* Desktop >= 1024px: 4 slides */
    @media (min-width: 1024px) {
        #homepage-breeds-carousel .splide__slide {
            flex: 0 0 calc((100% - 6rem) / 4);
        }
    }
    /* Tablet 768-1023px: 3 slides */
    @media (min-width: 768px) and (max-width: 1023.98px) {
        #homepage-breeds-carousel .splide__slide {
            flex: 0 0 calc((100% - 4rem) / 3);
        }
    }
    /* Mobile < 768px: 2 slides */
    @media (max-width: 767.98px) {
        #homepage-breeds-carousel .splide__slide {
            flex: 0 0 calc((100% - 2rem) / 2);
        }
    }
{% endstylesheet %}
