{%- comment -%}
  Vertical Accordion section
  Resembles a right-side vertical stepper/accordion with numbered tabs (01..04) and a main content area.

  Settings:
  - tagline: small text above heading
  - heading: main title
  - intro: short paragraph under heading
  Blocks (feature):
  - label: short tab label (shown rotated)
  - title: feature heading
  - text: feature description
  - image: optional image

  Uses Tailwind utility classes and theme CSS variables for colors and sizing.
{%- endcomment -%}

<section class="bg-bg-extralight py-16" data-va>
  <div class="w-full px-4 mx-auto">
    <div class="max-w-[var(--width-container-content)] mx-auto">
      {%- if section.settings.tagline != blank -%}
        <p class="text-sm tracking-wide uppercase text-[var(--color-body-copy)]/70">{{ section.settings.tagline }}</p>
      {%- endif -%}
      {%- if section.settings.heading != blank -%}
        <h2 class="font-titles font-bold text-4xl sm:text-5xl md:text-6xl leading-tight mt-1">{{ section.settings.heading }}</h2>
      {%- endif -%}
      {%- if section.settings.intro != blank -%}
        <div class="mt-3 text-base md:text-lg text-[var(--color-body-copy)] max-w-3xl">{{ section.settings.intro }}</div>
      {%- endif -%}

      <div class="mt-10 border border-black/20 rounded overflow-hidden">
        <div class="flex">
          <!-- Main panel area -->
          <div class="flex-1 p-6 md:p-10 bg-[var(--color-bg-light)]">
            {%- for block in section.blocks -%}
              <div data-va-panel class="va-panel" data-index="{{ forloop.index0 }}" id="va-panel-{{ forloop.index0 }}"{% unless forloop.index0 == section.settings.initial_index %} hidden{% endunless %}>
                <div class="text-[var(--color-body-copy)]/70 text-sm font-bold">{%- if forloop.index < 10 -%}0{{ forloop.index }}{%- else -%}{{ forloop.index }}{%- endif -%}</div>
                {%- if block.settings.title != blank -%}
                  <h3 class="mt-2 font-titles font-bold text-2xl md:text-3xl">{{ block.settings.title }}</h3>
                {%- endif -%}
                {%- if block.settings.text != blank -%}
                  <div class="mt-3 leading-relaxed text-[var(--color-body-copy)]">{{ block.settings.text }}</div>
                {%- endif -%}

                {%- if block.settings.image != blank -%}
                  <div class="mt-8">
                    {% render 'image', image: block.settings.image %}
                  </div>
                {%- else -%}
                  <div class="mt-8 bg-black/5 rounded-lg aspect-[16/9] grid place-items-center">
                    {{ 'image' | placeholder_svg_tag }}
                  </div>
                {%- endif -%}
              </div>
            {%- endfor -%}

            {%- if section.blocks.size == 0 -%}
              <div class="text-[var(--color-body-copy)]/70">Add feature blocks to populate this section.</div>
            {%- endif -%}
          </div>

          <!-- Right-side vertical tabs (hidden on small screens) -->
          <div class="hidden md:flex border-l border-black/10">
            {%- for block in section.blocks -%}
              <button
                type="button"
                class="relative w-12 shrink-0 flex flex-col items-center justify-start pt-6 pb-10 hover:bg-black/[0.03] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)] data-[active=true]:bg-black/[0.04]"
                data-va-tab
                data-index="{{ forloop.index0 }}"
                aria-controls="va-panel-{{ forloop.index0 }}"
                aria-selected="{% if forloop.index0 == section.settings.initial_index %}true{% else %}false{% endif %}"
                data-active="{% if forloop.index0 == section.settings.initial_index %}true{% else %}false{% endif %}"
              >
                <span class="text-xs font-bold text-[var(--color-body-copy)]">{%- if forloop.index < 10 -%}0{{ forloop.index }}{%- else -%}{{ forloop.index }}{%- endif -%}</span>
                <span class="absolute bottom-4 left-1/2 -translate-x-1/2 -rotate-90 origin-bottom-left whitespace-nowrap text-[10px] font-medium text-[var(--color-body-copy)]/80">
                  {{ block.settings.label | default: block.settings.title | default: 'Feature' }}
                </span>
              </button>
            {%- endfor -%}
          </div>
        </div>
      </div>

      <!-- Mobile tab buttons -->
      {%- if section.blocks.size > 1 -%}
      <div class="mt-4 flex md:hidden gap-2">
        {%- for block in section.blocks -%}
          <button
            type="button"
            class="px-2 py-1 text-sm rounded border border-black/10 text-[var(--color-body-copy)] hover:bg-black/[0.03] data-[active=true]:bg-black/[0.05]"
            data-va-tab
            data-index="{{ forloop.index0 }}"
            aria-controls="va-panel-{{ forloop.index0 }}"
            aria-selected="{% if forloop.index0 == section.settings.initial_index %}true{% else %}false{% endif %}"
            data-active="{% if forloop.index0 == section.settings.initial_index %}true{% else %}false{% endif %}"
          >
            {%- if forloop.index < 10 -%}0{{ forloop.index }}{%- else -%}{{ forloop.index }}{%- endif -%}
          </button>
        {%- endfor -%}
      </div>
      {%- endif -%}
    </div>
  </div>

  {% javascript %}
  (function(){
    const sections = document.querySelectorAll('[data-va]');
    if(!sections.length) return;

    sections.forEach((root)=>{
      const tabs = root.querySelectorAll('[data-va-tab]');
      const panels = root.querySelectorAll('[data-va-panel]');

      function activate(idx){
        panels.forEach((p,i)=>{
          if(i===idx){ p.classList.remove('hidden'); }
          else { p.classList.add('hidden'); }
        });
        tabs.forEach((t,i)=>{
          const active = i===idx;
          t.setAttribute('data-active', active);
          t.setAttribute('aria-selected', active ? 'true' : 'false');
        });
      }

      tabs.forEach(t=>{
        t.addEventListener('click', ()=>{
          const idx = parseInt(t.getAttribute('data-index'),10) || 0;
          activate(idx);
        });
      });
    });
  })();
  {% endjavascript %}
</section>

{% schema %}
{
  "name": "t:general.vertical_accordion",
  "blocks": [
    {
      "type": "feature",
      "name": "t:general.feature",
      "settings": [
        { "type": "text", "id": "label", "label": "t:labels.label", "default": "Feature" },
        { "type": "text", "id": "title", "label": "t:labels.title", "default": "Short heading goes here" },
        { "type": "richtext", "id": "text", "label": "t:labels.text", "default": "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros elementum tristique.</p>" },
        { "type": "image_picker", "id": "image", "label": "t:labels.image" }
      ]
    }
  ],
  "settings": [
    { "type": "text", "id": "tagline", "label": "t:labels.tagline", "default": "Tagline" },
    { "type": "text", "id": "heading", "label": "t:labels.heading", "default": "Medium length section heading goes here" },
    { "type": "richtext", "id": "intro", "label": "t:labels.intro", "default": "<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>" },
    { "type": "range", "id": "initial_index", "label": "t:labels.initial_index", "default": 0, "min": 0, "max": 9, "step": 1 }
  ],
  "presets": [
    {
      "name": "t:general.vertical_accordion",
      "blocks": [
        { "type": "feature" },
        { "type": "feature" },
        { "type": "feature" },
        { "type": "feature" }
      ]
    }
  ]
}
{% endschema %}
